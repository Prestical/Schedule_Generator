<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="main.js" defer></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
            <div class="toolbar">
                <button @click="toggleView('upload')">UPLOAD FILES</button>
                <button @click="generateSchedule">CREATE SCHEDULE</button>
                <div @change="loadDefaultFiles" v-for="(section, index) in sections" class="dropdown" :key="section.dataSet">
                    <button class="dropbtn">{{ section.title.toUpperCase() }}</button>
                    <div class="dropdown-content" >
                        <a href="#" @click=" modalData=section.dataSet; modalType=section.type; add();toggleView('add')">ADD</a>
                        <a href="#" @click=" modalData=section.dataSet; modalType=section.type; edit(); toggleView('edit')">EDIT</a>
                        <a href="#" @click=" modalData=section.dataSet; modalType=section.type; remove(); toggleView('remove')">REMOVE</a>
                    </div>
                </div>
            </div>
            <!-- file uploading section -->
            <div v-if="currentView === 'upload'">
                <div class="drag-area" @dragover.prevent="dragOver" @dragleave.prevent="dragLeave" @drop.prevent="handleDrop" @click="triggerFileInput">
                    <div class="icon">
                        <img src="img/csvIcon.png" alt="csv icon" style="width: 75px;">
                    </div>
                    <h6> Drag & Drop Your Files <br> or Browse Files</h6>
                    <span> Supported Format: csv </span>
                    <input type="file" ref="fileInput"  @change="handleFiles"  accept=".csv"  multiple  hidden>
                </div>
            </div>
            <!-- schedule section -->
        <div class="scheduleContainer" v-if="currentView === 'schedule'">
            <table>
                <thead>
                    <tr>
                        <th>DAY</th>
                        <th>Time</th>
                        <th v-for="year in 4">Year {{ year }}</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="day in days" :key="day" :class="day.toLowerCase()">
                        <td class="vertical-text">{{ day.toUpperCase() }}</td>
                        <td>
                            <ul>
                                <li v-for="time in times" :key="time">{{ time }}</li>
                            </ul>
                        </td>
                        <td v-for="year in 4" :key="`class-${year}`">
                            <ul>
                                <li v-for="time in times" :key="`time-${time}`">
                                    {{ getCourse(day, time, year) }}
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- add,delete,edit operations section -->
        <div class="addContainer" v-if=currentView==="add"> <!-- When we open add/remove/edit option it will show that csv file attribute-->
            <h3> Add an element to {{modalType.toUpperCase()}} </h3>
            <p>  Example Input : <em>{{Object.values(modalData[0])}}</em> </p>
            <form id="addForm" @submit.prevent="handleSubmit">
                <div v-for="key in Object.keys(modalData[0])">
                    <label class="custom-label">{{ key.toUpperCase() }}: </label>
                    <input class="custom-input" :id="key" v-model="formData[key]" :required="true"><br>
                </div>
                <input id="addInput" type="submit" value="Submit">
            </form>
        </div>
        <div v-if=currentView==="remove" class="removeContainer"> 
            <h3> Remove an element in {{modalType.toUpperCase()}} </h3>
                
            <div>
                <select v-model="selectedObject">
                    <option disabled value="">Please select</option>
                    <option v-for="object in modalData" :key="object.code" :value="object">{{ object.name }}</option>
                </select>
                <button @click="remove">REMOVE</button>
                <p>Selected Object: {{ selectedObject.name }}</p>
            </div>
            <div v-if="removedCourses.length > 0">
                <h2 id="removeH">Removed Courses</h2>
                <ul id="removeUl">
                    <li v-for="course in removedCourses" :key="course.code">
                        {{ course.code }} - {{ course.name }}
                    </li>
                </ul>
            </div>
        </div>
        <div v-if=currentView==="edit" class="editContainer"> 
            <h3 id="editH"> Edit an element in {{modalType.toUpperCase()}} </h3>
            <div>
                <select v-model="selectedObject">
                    <option disabled value="">Please select</option>
                    <option v-for="object in modalData" :key="object.code" :value="object">{{ object.name }}</option>
                </select>
                <!-- It shows the current properties of the course. It changes dynamically. -->
                <div v-if="selectedCourse">
                    <p>Code: {{ selectedCourse.code }}</p>
                    <p>Name: {{ selectedCourse.name }}</p>
                    <p>Year: {{ selectedCourse.year }}</p>
                    <p>Credit: {{ selectedCourse.credit }}</p>
                    <p>Type: {{ selectedCourse.type }}</p>
                    <p>Department/Service: {{ selectedCourse.department }}</p>
                    <p>Number of Students: {{ selectedCourse.students }}</p>
                    <p>Instructor Name: {{ selectedCourse.instructor }}</p>
                    <p>Course Hour Preference: {{ selectedCourse.hourPreference }}</p>
                </div>
                
                <select v-if="selectedCourse" v-model="editOption">
                    <p>Select the feature you want to edit</p>
                    <option disabled value="">Select the feature you want to edit</option>
                    <option v-for="option in editOptions" :key="option.value" :value="option.value">{{ option.label }}</option>
                </select>
                <div v-if="editOption !== '' && selectedCourse">
                    <input v-model="newValue" :placeholder="'Enter new ' + editOption" v-if="editOption !== 'name' && editOption !== 'year' && editOption !== 'credit' && editOption !== 'students' && editOption !== 'hourPreference'">
                    <input v-model="newValue" :placeholder="'Enter new ' + editOption" v-if="editOption === 'name'">
                    <input v-model="newValue" :placeholder="'Enter new ' + editOption" v-if="editOption === 'year'">
                    <input v-model="newValue" :placeholder="'Enter new ' + editOption" v-if="editOption === 'credit'">
                    <input v-model="newValue" :placeholder="'Enter new ' + editOption" v-if="editOption === 'students'">
                    <input v-model="newValue" :placeholder="'Enter new ' + editOption" v-if="editOption === 'hourPreference'">
                    <button @click="edit">Edit</button>
                </div>
            </div>
            
        </div>

        <div v-if="currentView === 'remove' || currentView === 'edit'||currentView === 'add'">
            <button @click="currentView= 'menu'" id="saveBtn"> SAVE</button>
        </div>

    </div>
</body>
</html>
