<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="main.js" defer></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
            <div class="toolbar">
                <button @click="toggleView('upload')">Upload Files</button>
                <button @click="generateSchedule">Create Schedule</button>
                <div @change="loadDefaultFiles" v-for="(section, index) in sections" class="dropdown" :key="section.dataSet">
                    <button class="dropbtn">{{ section.title }}</button>
                    <div class="dropdown-content" >
                        <a href="#" @click=" modalData=section.dataSet; modalType=section.type; add();toggleView('add')">Add</a>
                        <a href="#" @click=" modalData=section.dataSet; modalType=section.type; edit(); toggleView('edit')">Edit</a>
                        <a href="#" @click=" modalData=section.dataSet; modalType=section.type; remove(); toggleView('remove')">Remove</a>
                    </div>
                </div>
            </div>
            <div v-if="currentView === 'remove' || currentView === 'edit'||currentView === 'add'">
                <button @click="currentView= 'menu'" > SAVE</button>
            </div>
            <!-- file uploading section -->
            <div v-if="currentView === 'upload'">
                <div class="drag-area" @dragover.prevent="dragOver" @dragleave.prevent="dragLeave" @drop.prevent="handleDrop" @click="triggerFileInput">
                    <div class="icon">
                        <img src="img/csvIcon.png" alt="csv icon" style="width: 50px;">
                    </div>
                    <h6> Drag & Drop Your Files <br> or Browse Files</h6>
                    <span> Supported Format: csv </span>
                    <input type="file" ref="fileInput"  @change="handleFiles"  accept=".csv"  multiple  hidden>
                </div>
            </div>
            <!-- schedule section -->
        <div v-if="currentView === 'schedule'">
            <table>
                <thead>
                    <tr>
                        <th>DAY</th>
                        <th>Time</th>
                        <th v-for="year in 4">Year {{ year }}</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="day in days" :key="day" :class="day.toLowerCase()">
                        <td class="vertical-text">{{ day }}</td>
                        <td>
                            <ul>
                                <li v-for="time in times" :key="time">{{ time }}</li>
                            </ul>
                        </td>
                        <td v-for="year in 4" :key="`class-${year}`">
                            <ul>
                                <li v-for="time in times" :key="`time-${time}`">
                                    {{ getCourse(day, time, year) }}
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- add,delete,edit operations section -->
        <div v-if=currentView==='add'> <!-- When we open add/remove/edit option it will show that csv file attribute-->
            <h3> Add an element to {{modalType.toUpperCase()}} </h3>
            <p>  Example Input : <em>{{Object.values(modalData[0])}}</em> </p>
            <form id="addForm" @submit.prevent="handleSubmit">
                <div v-for="key in Object.keys(modalData[0])">
                    <label>{{ key.toUpperCase() }}: </label>
                    <input :id="key" v-model="formData[key]" :required="true"><br>
                </div>
                <input type="submit" value="Submit">
            </form>
        </div>
        <div v-if=currentView==='remove'> 
            <h3> Remove an element in {{modalType.toUpperCase()}} </h3>
                
            <div>
                <p>Selected Object: {{ selectedObject }}</p>
                <select v-model="selectedObject">
                    <option disabled value="">Please select</option>
                    <option v-for="object in modalData" :key="object.code" :value="object">{{ object.name }}</option>
                </select>
                <button @click="remove">Remove</button>
            </div>
        </div>
    </div>
</body>
</html>
